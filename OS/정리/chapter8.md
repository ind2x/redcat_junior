# A20 게이트를 활성화시켜 1MB 이상 영역에 접근해보자

## IA-32e 모드 커널과 메모리 맵

<br>

이번 장에서는 ```1) IA-32e 모드 커널을 실행하기 위해서 메모리가 64MB 이상인지``` 검사하고 ```2) IA-32e 모드 커널이 위치할 영역을 0으로 초기화```를 해주고, ```3) 1MB 이상의 메모리 주소에 정상적으로 접근할 수 있는지 확인하고 이를 위해 어떤 작업을 해야 하는지 확인``` 해볼 것이다. 

<br>

왜 1MB 이상의 메모리에 접근할 수 있어야 하는가?

현재 커널은 0x10000부터 시작하는데, 비디오 메모리가 0xA0000에 위치하여 사용 가능한 공간이 ```0xA0000 - 0x10000 = 576KB``` 정도가 된다.

커널에 기본적인 기능만 있다면 충분한 메모리 공간이지만, 우리는 다양한 기능을 추가해줄 것이기 때문에 부족하다.

따라서 MINt64 OS에서는 **커널 이미지는 0x10000에 복사시키되**, **크기가 큰 IA-32e 모드 커널은 2MB ~ 6MB 영역에 복사할 것**이다.

<br>

![image](https://user-images.githubusercontent.com/52172169/195786345-4482353e-a9b9-44d1-a164-22988a194c72.png)

<br>

그래서 이미지는 0x10000에 올리고, IA-32e 모드 커널은 2MB에 위치되어있다.

**IA-32e 모드 커널이 위치할 영역을 0으로 초기화시켜주는 이유**는 커널은 초기화되지 않은 영역이 있을 수 있으나, 커널 **이미지**는 초기화 되지 않은 영역이 없기 때문이다.

따라서 이미지를 2MB ~ 6MB에 복사했을 때, 초기화되어 있지 않다면 0 대신 이상한 값이 참조가 될 수 있어서 실행 중 오류가 발생할 수 있다.

<br><br>
<hr style="border: 2px solid;">
<br><br>

## IA-32e 모드 커널을 위한 메모리 초기화

<br>

main.c에 1MB부터 6MB까지의 영역을 초기화 해주는 코드 추가하는 챕터

<br>

![image](https://user-images.githubusercontent.com/52172169/195790211-17ed4c35-f7fc-45ca-910a-ec2595b42077.png)

<br>

근데 MINT64 OS를 프로그램을 통해 실제 PC에(플로피 디스크)에 복사하여 실행하면 에러가 나서 종료된다.

왜냐하면 실제 PC에서는 하위 기종과의 호환성을 위해 **어드레스 라인을 비활성화**했기 때문이라고 한다.

<br><br>
<hr style="border: 2px solid;">
<br><br>

## 1MB 어드레스와 A20 게이트

A20은 어드레스 라인의 번호를 뜻하는데, 이보다 더 중요한 내용을 가지고 있으며 시스템 포트와 BIOS 서비스를 통해 활성화 시킬 수 있다.

<br><br>

### A20 게이트의 의미와 용도
---

<br>





<br><br>

<br><br>
<hr style="border: 2px solid;">
<br><br>

