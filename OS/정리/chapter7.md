# C언어로 커널을 작성하자
## 실행 가능한 C코드 커널 생성 방법

<br>

이번 장에서 할 일은 c코드를 작성하여 이를 빌드하여 보호 모드 커널 이미지에 통합하는 것이다.

c언어로 작성한 커널을 보호모드 엔트리 포인트 뒷부분에 연결하고 엔트리 포인트에서는 C 커널의 시작부분으로 이동하는 것이다.

C코드는 컴파일과 링크 과정을 통해 결과물이 생성되는데 아래 그림과 같이 연결할 것이다.

<br>

![image](https://user-images.githubusercontent.com/52172169/195353132-4e3401f7-2415-4bc1-8ae0-9fa49bdc1e80.png)

<br>

<br><br>

### 빌드 조건과 제약 상황
---

<br>

+ C의 라이브러리를 호출하지 않게 빌드해야 한다.
  + 커널에서는 C의 라이브러리를 호출할 수 없기 때문에 라이브러리 함수가 실행되지 않게 된다.

<br>

+ ```0x10200```에서 C코드가 실행하게끔 빌드한다.
  + ```0x10000```에는 보호 모드 엔트리 포인트가 있으므로 결합된 C코드는 512바이트 이후에서 실행되어야 한다.

<br>

+ 코드나 데이터 외에 기타 정보를 포함하지 않는 순수한 바이너리 형태여야 한다.
  + gcc로 컴파일 해주면 ELF 포맷으로 나오기 때문에 그대로 사용 시 엔트리포인트에서 이를 해석해야 하므로 코드가 복잡해진다

<br><br>

### 소스 코드 컴파일 시 라이브러리를 사용하지 않은 오브젝트 파일 생성 방법
---

<br>

그러면 라이브러리를 호출하지 않게 빌드하려면 어떻게 해야하는가

홀로(Freestanding)라는 의미에서 컴파일 옵션으로 ```-ffreestanding```을 주면 된다.

따라서 ```clang -c -m32 -ffreestanding main.c```를 해주면 ```main.o```의 오브젝트 파일이 생성된다.

<br><br>

### 오브젝트 파일 링크 - 라이브러리를 사용하지 않고 특정 주소에서 실행 가능한 커 이미지 파일 생성 방법
---

<br>



<br><br>


