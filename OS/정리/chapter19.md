# 멀티레벨 큐로 업그레이드 및 태스크 종료 기능 추가

<br>

이번 장에서는 태스크에 우선순위를 부여해 줄 것이고, 태스크 종료 기능을 추가할 것이다.

<br>

## 태스크 우선순위와 멀티레벨 큐 스케줄러 알고리즘

<br>

멀티레벨 큐 스케줄러는 태스크가 대기하는 공간이 여러 개(우선순위 별로 구분)이므로 두 가지 스케줄링 정책이 필요하다.

바로 **여러 개의 큐 중에서 특정 큐를 선택하는 정책**과 **선택된 큐에서 태스크를 선택하는 정책**이다.

두 번째 정책은 18장에서 본 라운드 로빈 스케줄러 기법을 이용해서 해결하면 된다.

따라서 이번 장에서는 첫 번째 정책에 대해 살펴볼 것이다.

<br>

첫 번째 정책은 선택 기준에 따라 달라지는데, 만약 높은 우선순위 태스크들의 처리 시간을 무조건 보장하고자 한다면 높은 우선순위 태스크들을 모두 처리한 뒤 낮은 우선순위 태스크들을 처리하면 된다.

만약 고르게 처리하고자 한다면, 즉 우선순위 별로 고르게 처리하고자 한다면, 높은 우선순위의 모든 태스크를 1회씩 실행한 후 낮은 태스크 중에 하나를 1회 실행하는 계층적인 방법도 있다.

MINT64 OS는 고르게 처리하는 것을 지향한다.

<br>

MINT64 OS에서는 우선순위를 5가지(가장 높음 -> 높음 -> 중간 -> 낮음 -> 가장 낮음) 로 구분한다. 

이제 큐를 어떻게 선택할지에 대해서, MINT64 OS 스케줄링 정책은 ```우선순위를 보장하되 모든 태스크를 고르게 처리한다```라고 할 수 있다.

큐 내부 스케줄링 정책은 라운드 로빈을 따르므로 별다른 문제가 없으나, 우선순위에 따라 큐를 선택하면 낮은 우선순위 큐가 계속해서 처리가 되지 않는, **기아 현상**이 발생할 수 있다.

그래서 **MINT64 OS는 라운드 로빈에 따라 처리하되 우선순위를 보장해야 하므로, 우선순위가 높은 태스크를 1회씩 수행한 후 낮은 우선순의 태스크를 하나 수행할 것**이다.

아래는 해당 알고리즘이다.

<br>

![image](https://user-images.githubusercontent.com/52172169/202979339-4f4a351e-0229-47a5-ba35-989e5c1848b7.png)

<br>

3개의 우선순위로 구분되었고, 각 우선순위의 태스크가 모두 수행되었다면 그 다음 낮은 우선순위의 태스크를 1회씩 수행하는 것을 볼 수 있다.

즉, 높은 우선순위를 모두 수행하면 중간 우선순위 태스크를 하나 수행해주고, 반복되다가 중간 우선순위 태스크가 모두 1회씩 수행되었다면 낮음 우선순위 태스크를 하나 수행해주는 식으로 알고리즘이 진행된다.

<br><br>
<hr style="border: 2px solid;">
<br><br>

## 멀티레벨 큐 스케줄러 업그레이드

<br>

기존의 자료구조를 변경해줄 것으로, 멀티레벨 큐 스케줄러는 5개의 준비 큐(실행할 태스크를 선택하는 용도)와 1개의 대기 큐(종료할 태스크가 대기하는 큐)로 구성된다.

준비 큐는 리스트 형태로 구현하고, 대기 큐는 별도로 정의해 줄 것이며 대기 큐는 태스크 종료 기능을 구현하는데 사용된다.

여기부터는 p.672부터 책으로 복습

<br>

이 부분에서는 자료구조를 수정(우선순위 부여, 준비 큐, 대기 큐 추가)하고 스케줄러 초기화 함수, 태스크 선택 함수, 태스크 등록 함수를 업그레이드 해주었다.

추가로 빠진 부분인 우선순위를 동적으로 변경해주는 함수를 만들어 줄 것이다.

방법으로는 **해당 태스크가 수행 중일 때 우선순위를 변경**해주거나 **해당 태스크가 준비 큐에 있을 때, 해당 태스크를 제거한 뒤 우선순위를 변경해주고 다시 삽입**해주는 2가지 경우를 고려해줘야 한다.

<br>

여기까지 끝난다면 이제 **콘솔 셸과 다른 태스크와의 우선순위를 지정**해줘야 한다.

콘솔 셸의 우선순위는 가장 높음으로 설정해줘야 다른 태스크의 영향을 받지 않는다.

<br><br>
<hr style="border: 2px solid;">
<br><br>

## 태스크 종료와 유휴 태스크

<br>



<br><br>
<hr style="border: 2px solid;">
<br><br>
